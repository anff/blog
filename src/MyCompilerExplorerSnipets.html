<html>

<head>
<title> My Compiler Explorer Snipets </title>
</head>

<body>
<center>
  
<h1> My Compiler Explorer Snipets </h1>
  
  <h2> For loops in which compiler can't generate good instructions for `unsigned` </h2>
  <iframe width="1600px" height="700px" src="https://godbolt.org/e?readOnly=true&hideEditorToolbars=true#z:OYLghAFBqd5QCxAYwPYBMCmBRdBLAF1QCcAaPECAM1QDsCBlZAQwBtMQBGAFlICsupVs1qhkAUgBMAISnTSAZ0ztkBPHUqZa6AMKpWAVwC2tQVvQAZPLUwA5YwCNMxEAGYArKQAOqBYXW0eoYmgj5%2BanRWNvZGTi4eisqYqgEMBMzEBEHGppyJKhG0aRkEUXaOzm6eCumZ2SF5NSVlMXFVAJSKqAbEyBwA5FKu1siGWADU4q46AG7JRMRT2OIADACCq2vWBOM0qAD62xA16CAgc6okUzrbS5OSAGzM7ZMA7LLr41/j2%2BMKRpNXAARcYrKYfNbfXYkCC/PCAkFg1zSH6AnTjWH0drMAB0fgAXpgIO1wfdZDI8C9xO9NlCof8yVMQcxxO5pHhWUDwbTvtSuZ9vsRMAQerQ/kZues%2BZtNr89vsDLQ/MAbOhjgRTud5ldprdXNh7k8qTSBV9fgymaDJZDvjRiBBFcrVajLUiUfDruNcQSiSTkYyKcaIXTvhaZJaWWyOe4ucieV9pabxkKRcQxf9rYmNlL1nLUAcffsCOrNRcFtc9QapEa3sHvuaAa7rVC7cc8ISiy7gVb/R7pl68e3faS5HJKbX43Sw7Ju5H2Zzm7zXvybV8U6LxZnlzLc/RoQcvARiPgqFQiyWzmWdTd6Hdq88J0mGwie3Wvq3D8e8KfO33EaS%2B3RCBPxPM8CGxQdCWJEdw0DR9VynRtw1nVl5xjRcE23JN1zTTc4ylLDsy2Pd5QIAB3VAfG2ZwLy1S5Fl1W99UNB9qTfH49wtbs3UnVtmAMIgu2ZHEnGAaxoN7NEB3MCSUVHOC2MnekkJnEEACoOXwhCsyhHD0wlLSs36TpWBAfp3H6UhTH6FZLNQMydHklEFG6XpMHuVxOEsggzNs9pOgAaxAbgAA4cW4FZXk8yKVm4ABOB4VhC3hTP6bhLOs2zSHs/pLIUEAVlIHybOM0g4FgJA0CMLw8HYMgKAgKqarqkBgBCyRSCoWqCGcfKIAcXzLIcawMgATzMrzSCqowtAIAB5WhWHGkrSCwIwRGAdhBtWvAhRSOZ8pWzAAA9kgEgZJuo1KstYPAHGIMa9CwCbvOIPAjEGzoaHoJg2A4Hh%2BEEYRRBQJyhDu/LYFoZgZpAY6CFYUg5hcGz3FcUqIGh2H4a0FyyGR3zODi9LOkxmGOCoIwCCRyoj0VAL/Oyw8AkOgBaObJDypIUg0CBzHqXJSHMFoKhcPIwn8OgBdCXxJdoEXYkqRpucKYo6n0HJBCUApUlqUprHKRWxcUPXpcaPWFbaThOhcno%2Bi4EyzIsqztpy46QoeVmHm4cZgGQZBxjCyQMVwQgSA8vJxj0araucCOXkc2DpG8z7OgQTBmCwFxiVIIL3E4HF3Dix4QuLuL3BWVw4s4V4hDM9LSA%2BzgVkKzK7LMvKCqK1O6/6TmXZWnKU5Kxnkb8DRuCAA"></iframe>

  <h2> For loops in which compiler can't use register to cache the size() and data() </h2>
  <iframe width="1600px" height="700px" src="https://godbolt.org/e?readOnly=true&hideEditorToolbars=true#z:OYLghAFBqd5QCxAYwPYBMCmBRdBLAF1QCcAaPECAM1QDsCBlZAQwBtMQBGAFlICsupVs1qhkAUgBMAISnTSAZ0ztkBPHUqZa6AMKpWAVwC2tLgFZSW9ABk8tTADljAI0zEuABlIAHVAsLqtHqGJuY%2BfgF0tvZORq7unF5KKmp0DATMxATBxqacFsmYqoHpmQTRji5unooZWTmh%2BbVlFbHxngCUiqgGxMgcAORSAMx2yIZYANTiwzoAbkVExDPY4h4AgmvrdgSTNKgQCgToICALqiQzOjsr05IAbMykk3OoeOiTEABUCqhGmAQEHZgB0IB0OtMAOyyDaTOGTHaTBRGabDAAikw8Mxh63hkwA9PjJoDiJhMJN/kZiKgAJ6TVioZjoLZ4mjEQ54ABemAA%2Brs8KiMVjhtIEaidJNmAA6fzcsHYu6yGR4CHiaEsvHw37/QHA%2BUijWapEouQzDHMcRmaR4S1o7GGqF22Hw0kEXq0Y32jZqp2bDaI/aSQ7HU7nJZXG7DbB3R7PV7vT4/P4AoGiUHgqE4vGI5GCzFe3Farm83YKTl56WyzD6rPwwnEgDuqApmCptPpjOZzrhbI53L5YrN%2BZFg9mSM5CtNytV6u7mu1Kb1HQLRrhudN6MlluttpX8J9Dtd7s9Bu9kN9WwDqFQw2DJzOi0us0j0aksZebw%2B3wXurTYJntZwjmJqbsKgFIsWA5lhWMrFjWDqIl86C7EO0roMwGTwXO9Z0OSlLUnSDJMg6vZVgOApDmBo4SmWk4yHIKqZg6eI/qmwBYYWRrrvRm7IduNpmHap6cY6h4AseyIFge3obAMXSsCAAxmAMpCmAMHgqagik6FOoq/L0/R3MMnAqQQikaeCpAANYgNwkhSgAHJCkgePcDz3MZDlmMMDlCIp3AqWpGmkFpAwqQoIBeGZ6lyaQcCwEgaBGN4eDsGQFAQElKVpSAwAOZIpBUKlBBuBFEDOOZKnOHYmQ0opJmkEl/z0AA8rQrB1TFpBYEYIjAOwlXdXgpLFAsEVdZgAAeRQGCV9UqTsyiDaweDOMQtV6Fg82kAQxB4EYlVdDQ9BMGwHA8PwgjCKIKC6UIq0RbAtDMP8ICTQQrCkAs7jqd5sUQM9r3vVovxkN95mcAAnAFXQAy9HBUEYBBfdUu0GLQVmWag3ipLQ40ALQtZI4XKIsgSaNoDR5JY2itFUCThP4uNU4IvhM4EdNxNUnCKKTxRpHU2T6LkgiFPztClFknPtDzRxlCzsuC9L3NdPpfTnfJinKapg2hZNDn3Pj9zcJMwDIMgkwOVKkifLghAkEZPOTHoyWpW4jsQjp9EyKZh1dAgmBMtUYLWSAZiQlKnCSJCkPDJCwzDPcDk8G5FgKQMAWkAdiReEFmmKeFkU7X7fkDMTOtdaFvsxZZ33%2BBo3BAA"></iframe>

  <h2> Unique_ptr case 1 </h2>
  Using a unique_ptr in function internal, unique_ptr is zero overhead.
  <iframe width="1600px" height="700px" src="https://godbolt.org/e?readOnly=true&hideEditorToolbars=true#g:!((g:!((g:!((h:codeEditor,i:(fontScale:14,j:1,lang:c%2B%2B,selection:(endColumn:1,endLineNumber:12,positionColumn:1,positionLineNumber:12,selectionStartColumn:1,selectionStartLineNumber:1,startColumn:1,startLineNumber:1),source:'%23include+%3Cmemory%3E%0A%23include+%3Cutility%3E%0A%0Avoid+foo()+%7B%0A++++int+*ptr+%3D+new+int%3B%0A++++delete+ptr%3B%0A%7D%0A%0Avoid+foo2()+%7B%0A++++std::unique_ptr%3Cint%3E+ptr(new+int)%3B%0A%7D%0A'),l:'5',n:'0',o:'C%2B%2B+source+%231',t:'0')),k:30.043516100957362,l:'4',n:'0',o:'',s:0,t:'0'),(g:!((h:compiler,i:(compiler:g82,filters:(b:'0',binary:'1',commentOnly:'0',demangle:'0',directives:'0',execute:'1',intel:'0',libraryCode:'1',trim:'0'),fontScale:14,j:1,lang:c%2B%2B,libs:!((name:xtl,ver:'053'),(name:xtensor,ver:'0194'),(name:fmt,ver:trunk)),options:'-O2+--std%3Dc%2B%2B17',selection:(endColumn:1,endLineNumber:1,positionColumn:1,positionLineNumber:1,selectionStartColumn:1,selectionStartLineNumber:1,startColumn:1,startLineNumber:1),source:1),l:'5',n:'0',o:'x86-64+gcc+8.2+(Editor+%231,+Compiler+%231)+C%2B%2B',t:'0')),header:(),k:36.549121078990844,l:'4',m:100,n:'0',o:'',s:0,t:'0'),(g:!((h:output,i:(compiler:1,editor:1,fontScale:14,wrap:'1'),l:'5',n:'0',o:'%231+with+x86-64+gcc+8.2',t:'0')),k:33.40736282005181,l:'4',n:'0',o:'',s:0,t:'0')),l:'2',n:'0',o:'',t:'0')),version:4"></iframe>
  
  <h2> Unique_ptr case 2: return a unique_ptr is not zero overhead </h2>
  Returning raw pointer is by register. Returning unique_ptr is by stack.
  
  For cdecl, the caller should clean up the returning value.
  
  If you use the unique_ptr, then the compiler could assume your pointer is not null, then eliminate the branch for null pointer.
  
<iframe width="800px" height="200px" src="https://godbolt.org/e?readOnly=true&hideEditorToolbars=true#g:!((g:!((g:!((h:codeEditor,i:(fontScale:14,j:1,lang:c%2B%2B,selection:(endColumn:1,endLineNumber:35,positionColumn:1,positionLineNumber:35,selectionStartColumn:1,selectionStartLineNumber:35,startColumn:1,startLineNumber:35),source:'%23include+%3Cmemory%3E%0A%23include+%3Cutility%3E%0A%0Astd::unique_ptr%3Cint%3E+make_unique_ptr_int()+noexcept+%7B%0A++++auto+v+%3D+std::unique_ptr%3Cint%3E(new+int)%3B%0A++++return+std::move(v)%3B%0A%7D%0A%0Astd::unique_ptr%3Cint%3E+get_unique_ptr()%3B%0Aint+*get_raw_ptr()%3B%0A%0Avoid+foo()+%7B%0A++++auto+ptr+%3D+get_unique_ptr()%3B%0A%7D%0A%0Avoid+bar()+%7B%0A++++auto+ptr+%3D+get_raw_ptr()%3B%0A++++if(ptr)%0A++++++++delete+ptr%3B%0A%7D%0A%0Aint+foo2()+%7B%0A++++auto+ptr+%3D+get_unique_ptr()%3B%0A++++return+*ptr%3B++++%0A%7D%0A%0Aint+bar2()+%7B%0A++++auto+ptr+%3D+get_raw_ptr()%3B%0A++++int+v+%3D+*ptr%3B%0A++++delete+ptr%3B%0A++++return+v%3B%0A%7D%0A+%0A%0A'),l:'5',n:'0',o:'C%2B%2B+source+%231',t:'0')),k:45.248041775456926,l:'4',n:'0',o:'',s:0,t:'0'),(g:!((h:compiler,i:(compiler:g82,filters:(b:'0',binary:'1',commentOnly:'0',demangle:'0',directives:'0',execute:'1',intel:'0',libraryCode:'1',trim:'0'),fontScale:14,j:1,lang:c%2B%2B,libs:!((name:xtl,ver:'053'),(name:xtensor,ver:'0194'),(name:fmt,ver:trunk)),options:'-O2',selection:(endColumn:15,endLineNumber:52,positionColumn:15,positionLineNumber:52,selectionStartColumn:12,selectionStartLineNumber:52,startColumn:12,startLineNumber:52),source:1),l:'5',n:'0',o:'x86-64+gcc+8.2+(Editor+%231,+Compiler+%231)+C%2B%2B',t:'0')),header:(),k:54.75195822454309,l:'4',m:100,n:'0',o:'',s:0,t:'0')),l:'2',n:'0',o:'',t:'0')),version:4"></iframe>  
  
  <h2> Unique_ptr case 3: passing a unique_ptr is unpleasant </h2>
  
  Passing raw pointer is by register. Passing unique_ptr is by stack.
  
  The caller doesn't know if the callee take the owner ship of unqiue_ptr, so the caller must check that.
  
  g++ has some defect (I am not sure) in optimization of unqiue_ptr for `foo2`.
  
  <iframe width="800px" height="200px" src="https://godbolt.org/e?readOnly=true&hideEditorToolbars=true#z:OYLghAFBqd5QCxAYwPYBMCmBRdBLAF1QCcAaPECAM1QDsCBlZAQwBtMQBGAFlICsupVs1qhkAUgBMAISnTSAZ0ztkBPHUqZa6AMKpWAVwC2tQVvQAZPLUwA5YwCNMxEAGZOpAA6oFhdbT1DE0FvXzU6Kxt7IycXd0VlTFV/BgJmYgJA41MPJRVw2lT0gki7R2c3XLSMrOCq4tLo2MqASkVUA2JkDgByKVdrZEMsAGpxVx0jTCMSAE9x7HEABgBBfsHhzDGJgzVWQnnXRdXltdWFAnQQEANaPABHA0wAfU8CYnGdawIFkeRiTDMAgvW4PJ6vd4QFojWioTAAD26b3GslW3xGACp/oDgc9iMwAO4Q4hQmFwxGYZGuVErABuqDw6D%2BdAUxhBd0eLzeJIuVxuHPB3M%2B31%2B0NhCKRP2pp3pjOZtFZUzxhOJEHRGIxYvJkpRpxlDKZNFQpPEAHYaSNLSNeddQZzicL6L9aRAbASRt8WrrVlb5Yr2WCuZCbSAZrTMBBaS0vdKTqaACJ61aypkOdIm82nX3q7nbeMwzDukWxla%2BtAKtnKonciBSABs3JjFqteCoEEbWd9Vqw7GBIyFJbNiZOI7pBpGRskGeblpDdsF70dUuwI1peb%2BAKBAftNabnct5f9z3nQZ5l2uYYjUb3ceHZzHcsnz2n%2B79lZPquxW%2BPAtPUJvawJkmD6pukU7QmaM4evQmJruM%2BZfri%2BLVpCAFliylbIaq9ZRt6pYtm2uE%2Bl2lo9pgfa0nhQ6nD0bSsCAPQAKw9KQpg9EsLGoAxOhyHI1odF0Wz9JwLEEAxHHRqQADWIDcAAHAAdKapqSHJ3CMQAnIxrhLEskh1pIQgMdwLFsRxpBcT0LEKCASykGJ7G0aQcCwEgaBGJ4eDsGQFAQO5nneSAwAaYZVBecCxA2RADjiSxDjWOkswMSJpDuVM9AAPK0KwSWOaQWBGCIwDsLF%2BV4ACyThjZeUIkkuy9Cl3zKKV%2BwOPixCzHoWCle8eBGLFbQ0PQTBsBwPD8IIwiiCgvEyEIeAODZsC0MwUwgPCBCsKQ4YuOx2lOa6q0cBtWgKCQ20VOxnAaSZbSHWtVBGAQF0uO8txSZJqBvP41UALQZa41mJMkGgQOYtQ5HWpDmI05QuHWHihH4dAQ1wUNIwUsMxBUCMJPkKTVJk%2BjZFwrh40kBRFBkWPNLjFzFKjnBk/T1PWGU2Pw5wbRnZ03RcHRDHMaxpWWfCcl1r9dbcCMwDIMgIwaQpkgjBAuCECQYySPEIx6B5XnOJr7jQjxMhyKJA1tAggJYC4ULSSAjGcErkimpwjHcEs3B1hpGmmq4GlGT0JmkP1nC6cLeWWdZtn2RbgeSKZIsMebjmSTtvgaNwQA%3D%3D%3D"></iframe>

  
  
  </center>
</body>
  
</html>
